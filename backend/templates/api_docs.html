<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - Gliacloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-gradient-to-r from-emerald-500 to-emerald-600 text-white shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-bold">Gliacloud</h1>
            <div class="flex items-center gap-4">
                <span class="text-emerald-100 text-sm">{% if user %}{{ user.username }}{% if user.role == 'admin' %} (admin){% endif %}{% endif %}</span>
                <a href="/logout" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl text-sm font-medium transition-colors">Logout</a>
            </div>
        </div>
    </div>

    <!-- Nav menu -->
    <div class="container mx-auto px-6 py-2 flex gap-4 border-b bg-white shadow-sm text-sm">
        <a href="/data" class="text-gray-600 hover:text-emerald-600">Data</a>
        {% if user and user.role == 'admin' %}
        <a href="/users" class="text-gray-600 hover:text-emerald-600">Users</a>
        <a href="/slot-assignments" class="text-gray-600 hover:text-emerald-600">Slot Assignment</a>
        <a href="/shares" class="text-gray-600 hover:text-emerald-600">Share Config</a>
        {% endif %}
        <a href="/api-docs" class="font-semibold text-emerald-600">API Docs</a>
    </div>
    <div class="container mx-auto px-6 py-6 max-w-4xl">
        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-4 mb-6">
            <p class="font-medium text-emerald-800 mb-1">Base URL</p>
            <p class="text-emerald-900"><a href="{{ base_url }}/" target="_blank" rel="noopener" class="text-emerald-600 hover:underline font-mono">{{ base_url }}/</a></p>
        </div>
        <p class="text-gray-600 mb-6">All data endpoints are <strong>GET</strong> only. Use them to fetch and filter data. Authentication: either use your session (browser) or send <code class="bg-gray-100 px-1 rounded">X-API-Key: YOUR_API_KEY</code> in the request header.</p>

        {% if user and user.can_view_data and user.api_key %}
        <div class="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
            <p class="font-medium text-amber-800 mb-1">Your API Key (keep secret)</p>
            <code class="block break-all text-sm text-amber-900">{{ user.api_key }}</code>
            <p class="text-amber-700 text-sm mt-2">Example: <code class="bg-amber-100 px-1 rounded break-all">curl -H "X-API-Key: {{ user.api_key }}" "{{ base_url }}/api/data?from_date=2026-01-01&amp;to_date=2026-01-31"</code></p>
        </div>
        {% elif user and user.role == 'admin' %}
        <div class="bg-gray-100 rounded-xl p-4 mb-6 text-sm text-gray-700">Admins can access API with session cookie. For API key, edit your user and enable "Can view data" to get an API key.</div>
        {% endif %}

        <div class="space-y-8">
            <section class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-2">GET /api/data</h2>
                <p class="text-gray-600 mb-4">Dashboard revenue data (aggregated by slot, desktop + mobile).</p>
                <p class="text-sm font-medium text-gray-700 mb-1">Query parameters (all optional):</p>
                <ul class="list-disc list-inside text-gray-600 text-sm space-y-1 mb-4">
                    <li><code>fetch_date</code> – single date (YYYY-MM-DD)</li>
                    <li><code>from_date</code> – start of date range (YYYY-MM-DD)</li>
                    <li><code>to_date</code> – end of date range (YYYY-MM-DD)</li>
                    <li><code>slot</code> – filter by slot name</li>
                    <li><code>limit</code> – max records (default 100, max 2000)</li>
                    <li><code>offset</code> – skip N records (pagination)</li>
                </ul>
                <p class="text-sm text-gray-500">Example: <code class="bg-gray-100 px-1 rounded">/api/data?from_date=2026-01-01&amp;to_date=2026-12-31&amp;slot=spotpariz</code></p>
            </section>

            <section class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-2">Authentication</h2>
                <p class="text-gray-600 mb-2">Use one of:</p>
                <ol class="list-decimal list-inside text-gray-600 text-sm space-y-1">
                    <li><strong>Browser:</strong> Log in; same session is used for API calls from the same origin.</li>
                    <li><strong>X-API-Key header:</strong> Add <code class="bg-gray-100 px-1 rounded">X-API-Key: YOUR_API_KEY</code> to each request. Your API key is shown above if you have &quot;Can view data&quot; permission.</li>
                </ol>
                <p class="text-gray-500 text-sm mt-2">Without valid auth you get <code>401 Unauthorized</code>.</p>
            </section>
        </div>
    </div>
</body>
</html>
